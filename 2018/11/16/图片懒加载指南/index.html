<!DOCTYPE html>
<html>
<head>
   
    <meta name="google-site-verification" content="eT6z9XB4VBJFIWDkSRE_oluEnERXP2CMoNHOA5G17Ig" />
    <meta name="google-site-verification" content="LzpVBZJ1TvlKScvIcz7ONbZbDYBILOkadSYuYRjoS2I" />
    <meta name="baidu-site-verification" content="lY2UMwTs1m" />
    <meta name="baidu-site-verification" content="CvNaoy7f0j" />
  <meta charset="utf-8">
  
  <title>图片懒加载指南 | KAIGE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="概述 图片一般在整个网站上占用的资源比较大，但我们如何更快的加载这些图片呢？  延迟加载是Web和应用程序开发中的一组技术，它们将页面上的资源加载延迟到以后的时间点 - 实际需要这些资源而不是预先加载它们。这些技术有助于提高性能，更好地利用设备资源并降低相关成本。">
<meta name="keywords" content="图片懒加载指南">
<meta property="og:type" content="article">
<meta property="og:title" content="图片懒加载指南">
<meta property="og:url" content="https://www.kaige1220.top/2018/11/16/图片懒加载指南/index.html">
<meta property="og:site_name" content="KAIGE">
<meta property="og:description" content="概述 图片一般在整个网站上占用的资源比较大，但我们如何更快的加载这些图片呢？  延迟加载是Web和应用程序开发中的一组技术，它们将页面上的资源加载延迟到以后的时间点 - 实际需要这些资源而不是预先加载它们。这些技术有助于提高性能，更好地利用设备资源并降低相关成本。">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9ove8nhmj30bf06vaa2.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9owwplprj30bf06vdfu.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9ozx1a1zj30e70bhglp.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9p28g41fj30e70bh757.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9p2nvouxj30cg08e3yi.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9py3j4hij30fa0f474y.jpg">
<meta property="og:updated_time" content="2018-11-16T07:20:02.245Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="图片懒加载指南">
<meta name="twitter:description" content="概述 图片一般在整个网站上占用的资源比较大，但我们如何更快的加载这些图片呢？  延迟加载是Web和应用程序开发中的一组技术，它们将页面上的资源加载延迟到以后的时间点 - 实际需要这些资源而不是预先加载它们。这些技术有助于提高性能，更好地利用设备资源并降低相关成本。">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9ove8nhmj30bf06vaa2.jpg">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/scrollUp/image.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">KAIGE</div>
      
   
            <nav class="my-navbar">
                    <ul class="my-navbar-ul" >
                      
                        <li>
                          <a href="/" class="menu-item-link">
                              <img src="/home.png" alt="Profile Picture">
                          </a>
                          <span>Home</span>
                        </li>
                      

                      
                        <li>
                          <a href="http://txz1220.coding.me/resume/" class="menu-item-link">
                              <img src="/resume.png" alt="Profile Picture">
                          </a>
                          <span>resume</span>
                        </li>
                      

                      
                        <li>
                          <a href="/archives" class="menu-item-link">
                              <img src="/archives.png" alt="Profile Picture">
                          </a>
                          <span>Achiver</span>
                        </li>
                      

                      
                        <li>
                          <a href="/tags" class="menu-item-link">
                              <img src="/tags.png" alt="Profile Picture">
                          </a>
                          <span>Tags</span>
                        </li>
                      

                      
                        <li>
                          <a href="https://github.com/txz1220" class="menu-item-link" target="_blank">
                              <img src="/github.png" alt="Profile Picture">
                          </a>
                          <span>Github</span>
                        </li>
                      


                      
                        <li>
                          <a href="https://weibo.com/5675638137/profile?topnav=1&wvr=6&is_all=1" class="menu-item-link" target="_blank">
                              <img src="/weibo.png" alt="Profile Picture">
                          </a>
                          <span>Weibo</span>
                        </li>
                      
                    </ul>
            </nav>
                

    </div>
 
  </div>

  <div id="header-inner" class="">

    <nav id="title-nav" style="display:none">
      <a href="/">KAIGE</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="https://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="www.kaige1220.top">
      </form>
    </div>
  </div>
  
</header>
      <div class="outer">
        <section id="main"><article id="post-图片懒加载指南" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/16/图片懒加载指南/" class="article-date">
  <time datetime="2018-11-16T01:07:51.740Z" itemprop="datePublished">2018-11-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/技术/">技术</a>►<a class="article-category-link" href="/categories/技术/图片懒加载指南/">图片懒加载指南</a>
  </div>

    
    <span id="busuanzi_container_page_pv">
        本文共被围观<span id="busuanzi_value_page_pv"></span>次
      </span>
      
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      图片懒加载指南
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><hr>
<p>图片一般在整个网站上占用的资源比较大，但我们如何更快的加载这些图片呢？</p>
<blockquote>
<p>延迟加载是Web和应用程序开发中的一组技术，它们将页面上的资源加载延迟到以后的时间点 - 实际需要这些资源而不是预先加载它们。这些技术有助于提高性能，更好地利用设备资源并降低相关成本。<br><a id="more"></a></p>
</blockquote>
<h1 id="延迟加载技术"><a href="#延迟加载技术" class="headerlink" title="延迟加载技术"></a>延迟加载技术</h1><hr>
<p>图像加载到页面有两种方式：<code>&lt;img&gt;</code>  标记  和css里面的<code>background-image</code>。<br>首先看第一种：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/path/to/some/image.jpg"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>延迟加载如何做呢？</p>
<p>第一步是防止图像正面加载。浏览器使用src标记的属性来触发图像加载。如果它是HTML中的第一个或第1,000个图像并不重要。如果浏览器获取该src属性，它将触发要下载的图像，无论它是在当前视图中还是在当前视图之外。</p>
<p>要延迟加载，我们需要把src的属性替换掉：  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/default-image.jpg"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>既然我们正在阻止图像加载，我们需要告诉浏览器何时加载它。否则，它永远不会发生。为此，我们检查一旦图像（即其占位符）进入视口，我们就会触发加载。</p>
<p>有两种方式可以实现：</p>
<h3 id="1、使用Javascript事件触发图像加载"><a href="#1、使用Javascript事件触发图像加载" class="headerlink" title="1、使用Javascript事件触发图像加载"></a>1、使用Javascript事件触发图像加载</h3><p>这种技术使用的事件侦听器<code>scroll</code> (滚动事件)，<code>resize</code> （窗口改变事件）以及<code>orientationChange</code> （窗口翻转事件）；</p>
<blockquote>
<p>滚动时，滚动事件会快速触发多次。因此，为了提高性能，我们在脚本中添加了一个小超时，限制了延迟加载函数的执行，因此它不会阻止在浏览器中的同一个线程中运行的其他任务。</p>
</blockquote>
<p>方法示例：</p>
<p>在这之前先了解下：</p>
<ol>
<li><p>clientHeight = (padding + content) clientHeight：包括padding但不包括border、水平滚动条、margin的元素的高度。对于inline的元素这个属性一直是0，单位px，只读元素。</p>
</li>
<li><p>clientWidth   不包含滚动条<br><img src="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9ove8nhmj30bf06vaa2.jpg" alt=""></p>
</li>
<li><p>offsetHeight：包括padding、border、水平滚动条，但不包括margin的元素的高度。对于inline的元素这个属性一直是0，单位px，只读元素。</p>
</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9owwplprj30bf06vdfu.jpg" alt=""></p>
<ol start="4">
<li>当本元素的子元素比本元素高且overflow=scroll时，本元素会scroll，这时：<br>scrollHeight: 因为子元素比父元素高，父元素不想被子元素撑的一样高就显示出了滚动条，在滚动的过程中本元素有部分被隐藏了，scrollHeight代表包括当前不可见部分的元素的高度。而可见部分的高度其实就是clientHeight，也就是scrollHeight&gt;=clientHeight恒成立。在有滚动条时讨论scrollHeight才有意义，在没有滚动条时scrollHeight==clientHeight恒成立。单位px，只读元素。</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9ozx1a1zj30e70bhglp.jpg" alt=""></p>
<ol start="5">
<li>scrollTop: 代表在有滚动条时，滚动条向下滚动的距离也就是元素顶部被遮住部分的高度。在没有滚动条时scrollTop==0恒成立。单位px，可读可设置。</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9p28g41fj30e70bh757.jpg" alt=""></p>
<ol start="6">
<li>offsetTop: 当前元素顶部距离最近父元素顶部的距离,和有没有滚动条没有关系。单位px，只读元素。</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9p2nvouxj30cg08e3yi.jpg" alt=""></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">img &#123;</span></span><br><span class="line"><span class="undefined">  background: #F1F1FA;</span></span><br><span class="line"><span class="undefined">  width: 400px;</span></span><br><span class="line"><span class="undefined">  height: 300px;</span></span><br><span class="line"><span class="undefined">  display: block;</span></span><br><span class="line"><span class="undefined">  margin: 10px auto;</span></span><br><span class="line"><span class="undefined">  border: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image1.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image2.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image3.jpg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image4.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image5.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image6.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image7.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image8.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image9.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image10.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> lazyloadImages = <span class="built_in">document</span>.querySelectorAll(<span class="string">"img.lazy"</span>);     </span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> lazyloadThrottleTimeout;</span></span><br><span class="line"><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">lazyload</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(lazyloadThrottleTimeout) &#123;</span></span><br><span class="line"><span class="undefined">      clearTimeout(lazyloadThrottleTimeout);</span></span><br><span class="line"><span class="undefined">    &#125;    </span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript">    lazyloadThrottleTimeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> scrollTop = <span class="built_in">window</span>.pageYOffset;</span></span><br><span class="line"><span class="javascript">        lazyloadImages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">img</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(img.offsetTop &lt; (<span class="built_in">window</span>.innerHeight + scrollTop)) &#123;</span></span><br><span class="line"><span class="undefined">              img.src = img.dataset.src;</span></span><br><span class="line"><span class="javascript">              img.classList.remove(<span class="string">'lazy'</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(lazyloadImages.length == <span class="number">0</span>) &#123; </span></span><br><span class="line"><span class="javascript">          <span class="built_in">document</span>.removeEventListener(<span class="string">"scroll"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.removeEventListener(<span class="string">"resize"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.removeEventListener(<span class="string">"orientationChange"</span>, lazyload);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;, 20);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.addEventListener(<span class="string">"scroll"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.addEventListener(<span class="string">"orientationChange"</span>, lazyload);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="方法2、使用Intersection-Observer-API触发图像加载"><a href="#方法2、使用Intersection-Observer-API触发图像加载" class="headerlink" title="方法2、使用Intersection Observer API触发图像加载"></a>方法2、使用Intersection Observer API触发图像加载</h2><p>好了，现在我们先学习下：</p>
<h3 id="1-API"><a href="#1-API" class="headerlink" title="1. API"></a>1. API</h3><p>用法非常简单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> io = <span class="keyword">new</span> IntersectionObserver(callback, option);</span><br></pre></td></tr></table></figure>
<p>上面代码中，<code>IntersectionObserver</code>是浏览器原生提供的构造函数，接受两个参数：<code>callback</code>是可见性变化时的回调函数，<code>option</code>是配置对象（该参数可选）。</p>
<p>构造函数的返回值是一个观察器实例。实例的<code>observe</code>方法可以指定观察哪个 DOM 节点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开始观察</span></span><br><span class="line">io.observe(<span class="built_in">document</span>.getElementById(<span class="string">'example'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止观察</span></span><br><span class="line">io.unobserve(element);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭观察器</span></span><br><span class="line">io.disconnect();</span><br></pre></td></tr></table></figure>
<p>上面代码中，observe的参数是一个 DOM 节点对象。如果要观察多个节点，就要多次调用这个方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">io.observe(elementA);</span><br><span class="line">io.observe(elementB);</span><br></pre></td></tr></table></figure>
<h3 id="2-callback-参数"><a href="#2-callback-参数" class="headerlink" title="2. callback 参数"></a>2. callback 参数</h3><p>目标元素的可见性变化时，就会调用观察器的回调函数<code>callback</code>。</p>
<p><code>callback</code>一般会触发两次。一次是目标元素刚刚进入视口（开始可见），另一次是完全离开视口（开始不可见）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> io = <span class="keyword">new</span> IntersectionObserver(</span><br><span class="line">  entries =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(entries);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="3-IntersectionObserverEntry-对象"><a href="#3-IntersectionObserverEntry-对象" class="headerlink" title="3. IntersectionObserverEntry 对象"></a>3. IntersectionObserverEntry 对象</h3><p><code>IntersectionObserverEntry</code>对象提供目标元素的信息，一共有六个属性。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  time: 3893.92,</span><br><span class="line">  rootBounds: ClientRect &#123;</span><br><span class="line">    bottom: 920,</span><br><span class="line">    height: 1024,</span><br><span class="line">    left: 0,</span><br><span class="line">    right: 1024,</span><br><span class="line">    top: 0,</span><br><span class="line">    width: 920</span><br><span class="line">  &#125;,</span><br><span class="line">  boundingClientRect: ClientRect &#123;</span><br><span class="line">     // ...</span><br><span class="line">  &#125;,</span><br><span class="line">  intersectionRect: ClientRect &#123;</span><br><span class="line">    // ...</span><br><span class="line">  &#125;,</span><br><span class="line">  intersectionRatio: 0.54,</span><br><span class="line">  target: element</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每个属性的含义如下。</p>
<ul>
<li>time：可见性发生变化的时间，是一个高精度时间戳，单位为毫秒</li>
<li>target：被观察的目标元素，是一个 DOM 节点对象</li>
<li>rootBounds：根元素的矩形区域的信息，getBoundingClientRect()方法的返回值，如果没有根元素（即直接相对于视口滚动），  则- 返回null</li>
<li>boundingClientRect：目标元素的矩形区域的信息</li>
<li>intersectionRect：目标元素与视口（或根元素）的交叉区域的信息</li>
<li>intersectionRatio：目标元素的可见比例，即intersectionRect占boundingClientRect的比例，完全可见时为1，完全不可见   时- 小于等于0</li>
</ul>
<p>   <img src="https://ws1.sinaimg.cn/large/006c6oKBgy1fx9py3j4hij30fa0f474y.jpg" alt=""></p>
<p>学到这里先来实现下我们上个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> lazyloadImages;    </span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"IntersectionObserver"</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span><br><span class="line">    lazyloadImages = <span class="built_in">document</span>.querySelectorAll(<span class="string">".lazy"</span>);</span><br><span class="line">    <span class="keyword">var</span> imageObserver = <span class="keyword">new</span> IntersectionObserver(<span class="function"><span class="keyword">function</span>(<span class="params">entries, observer</span>) </span>&#123;</span><br><span class="line">      entries.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">entry</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (entry.isIntersecting) &#123;</span><br><span class="line">          <span class="keyword">var</span> image = entry.target;</span><br><span class="line">          image.src = image.dataset.src;</span><br><span class="line">          image.classList.remove(<span class="string">"lazy"</span>);</span><br><span class="line">          imageObserver.unobserve(image);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    lazyloadImages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">image</span>) </span>&#123;</span><br><span class="line">      imageObserver.observe(image);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="keyword">var</span> lazyloadThrottleTimeout;</span><br><span class="line">    lazyloadImages = <span class="built_in">document</span>.querySelectorAll(<span class="string">".lazy"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">lazyload</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(lazyloadThrottleTimeout) &#123;</span><br><span class="line">        clearTimeout(lazyloadThrottleTimeout);</span><br><span class="line">      &#125;    </span><br><span class="line"></span><br><span class="line">      lazyloadThrottleTimeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> scrollTop = <span class="built_in">window</span>.pageYOffset;</span><br><span class="line">        lazyloadImages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">img</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(img.offsetTop &lt; (<span class="built_in">window</span>.innerHeight + scrollTop)) &#123;</span><br><span class="line">              img.src = img.dataset.src;</span><br><span class="line">              img.classList.remove(<span class="string">'lazy'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span>(lazyloadImages.length == <span class="number">0</span>) &#123; </span><br><span class="line">          <span class="built_in">document</span>.removeEventListener(<span class="string">"scroll"</span>, lazyload);</span><br><span class="line">          <span class="built_in">window</span>.removeEventListener(<span class="string">"resize"</span>, lazyload);</span><br><span class="line">          <span class="built_in">window</span>.removeEventListener(<span class="string">"orientationChange"</span>, lazyload);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">"scroll"</span>, lazyload);</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, lazyload);</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"orientationChange"</span>, lazyload);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="4-Option-对象"><a href="#4-Option-对象" class="headerlink" title="4. Option 对象"></a>4. Option 对象</h3><p><code>IntersectionObserver</code>构造函数的第二个参数是一个配置对象。它可以设置以下属性。</p>
<h4 id="threshold-属性"><a href="#threshold-属性" class="headerlink" title="threshold 属性"></a>threshold 属性</h4><p><code>threshold</code>属性决定了什么时候触发回调函数。它是一个数组，每个成员都是一个门槛值，默认为[0]，即交叉比例（<code>intersectionRatio</code>）达到0时触发回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> IntersectionObserver(</span><br><span class="line">  entries =&gt; &#123;<span class="comment">/* ... */</span>&#125;, </span><br><span class="line">  &#123;</span><br><span class="line">    threshold: [<span class="number">0</span>, <span class="number">0.25</span>, <span class="number">0.5</span>, <span class="number">0.75</span>, <span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>用户可以自定义这个数组。比如，[0, 0.25, 0.5, 0.75, 1]就表示当目标元素 0%、25%、50%、75%、100% 可见时，会触发回调函数。</p>
<h3 id="root-属性，rootMargin-属性"><a href="#root-属性，rootMargin-属性" class="headerlink" title="root 属性，rootMargin 属性"></a>root 属性，rootMargin 属性</h3><p>很多时候，目标元素不仅会随着窗口滚动，还会在容器里面滚动（比如在<code>iframe</code>窗口里滚动）。容器内滚动也会影响目标元素的可见性，参见本文开始时的那张示意图。</p>
<p><code>IntersectionObserver API</code> 支持容器内滚动。<code>root</code>属性指定目标元素所在的容器节点（即根元素）。注意，容器元素必须是目标元素的祖先节点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> opts = &#123; </span><br><span class="line">  root: <span class="built_in">document</span>.querySelector(<span class="string">'.container'</span>),</span><br><span class="line">  rootMargin: <span class="string">"500px 0px"</span> </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> observer = <span class="keyword">new</span> IntersectionObserver(</span><br><span class="line">  callback,</span><br><span class="line">  opts</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>上面代码中，除了<code>root</code>属性，还有<code>rootMargin</code>属性。后者定义根元素的<code>margin</code>，用来扩展或缩小<code>rootBounds</code>这个矩形的大小，从而影响<code>intersectionRect</code>交叉区域的大小。它使用CSS的定义方法，比如10px 20px 30px 40px，表示 <code>top</code>、<code>right</code>、<code>bottom</code>和 <code>left</code> 四个方向的值。</p>
<h1 id="延迟加载CSS背景图像"><a href="#延迟加载CSS背景图像" class="headerlink" title="延迟加载CSS背景图像"></a>延迟加载CSS背景图像</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my-class</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'/path/to/some/image.jpg'</span>);</span><br><span class="line">  <span class="comment">/* more styles */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CSS背景图像不像图像标记那么简单。要加载它们，浏览器需要构建DOM树以及CSSOM树来确定CSS样式是否适用于当前文档中的DOM节点。如果指定背景图像的CSS规则不适用于文档中的元素，则浏览器不会加载背景图像。如果CSS规则适用于当前文档中的元素，则浏览器会加载图像。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">   * &#123;</span></span><br><span class="line"><span class="undefined">  font-family: sans-serif;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#container</span> &#123;</span></span><br><span class="line"><span class="undefined">  font-size: 20px;</span></span><br><span class="line"><span class="undefined">  line-height: 30px;</span></span><br><span class="line"><span class="undefined">  max-width: 600px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#bg-image</span><span class="selector-class">.lazy</span> &#123;</span></span><br><span class="line"><span class="undefined">   background-image: none;</span></span><br><span class="line"><span class="css">   <span class="selector-tag">background-color</span>: <span class="selector-id">#F1F1FA</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-id">#bg-image</span> &#123;</span></span><br><span class="line"><span class="undefined">  background-image: url("https://ik.imagekit.io/demo/img/image10.jpeg?tr=w-600,h-400");</span></span><br><span class="line"><span class="undefined">  max-width: 600px;</span></span><br><span class="line"><span class="undefined">  height: 400px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Lazy loading CSS background images<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam at ligula non lorem facilisis finibus. Suspendisse turpis lacus, tempus sit amet dignissim sit amet, pretium non sem. Ut malesuada purus ac magna placerat, tempus commodo turpis consectetur. Nunc vitae metus vehicula nunc congue varius. Suspendisse egestas urna non finibus feugiat. Vestibulum maximus, nunc et tempus convallis, dui ante vestibulum est, in lobortis purus sapien eget lacus. Suspendisse cursus enim non quam mollis imperdiet. Pellentesque convallis eget nunc vitae fringilla. Fusce interdum, velit semper varius aliquet, eros sapien facilisis erat, iaculis vulputate erat arcu vel neque. Suspendisse dignissim hendrerit lorem. Etiam metus ex, finibus vitae iaculis vitae, iaculis non ex. Phasellus commodo id ante id consequat. Nunc consectetur viverra lacus non fringilla. Pellentesque nec nisl vulputate, sagittis nisl id, venenatis nisi. Nunc malesuada tellus a elit suscipit tempor.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">Nam lacinia tortor quis volutpat lacinia. Aliquam in orci in nunc vehicula maximus. Phasellus elementum nulla augue, at aliquam sem pulvinar dapibus. Vivamus molestie venenatis risus pulvinar interdum. Phasellus blandit tortor eget nulla sagittis auctor. Cras sed leo in velit lobortis euismod. Suspendisse non ante tellus.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"bg-image"</span> <span class="attr">class</span>=<span class="string">"lazy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">Nam lacinia tortor quis volutpat lacinia. Aliquam in orci in nunc vehicula maximus. Phasellus elementum nulla augue, at aliquam sem pulvinar dapibus. Vivamus molestie venenatis risus pulvinar interdum. Phasellus blandit tortor eget nulla sagittis auctor. Cras sed leo in velit lobortis euismod. Suspendisse non ante tellus.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> lazyloadImages;    </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">if</span> (<span class="string">"IntersectionObserver"</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span></span><br><span class="line"><span class="javascript">    lazyloadImages = <span class="built_in">document</span>.querySelectorAll(<span class="string">".lazy"</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> imageObserver = <span class="keyword">new</span> IntersectionObserver(<span class="function"><span class="keyword">function</span>(<span class="params">entries, observer</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      entries.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">entry</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (entry.isIntersecting) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> image = entry.target;</span></span><br><span class="line"><span class="javascript">          image.classList.remove(<span class="string">"lazy"</span>);</span></span><br><span class="line"><span class="undefined">          imageObserver.unobserve(image);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    lazyloadImages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">image</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">      imageObserver.observe(image);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="javascript">  &#125; <span class="keyword">else</span> &#123;  </span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> lazyloadThrottleTimeout;</span></span><br><span class="line"><span class="javascript">    lazyloadImages = <span class="built_in">document</span>.querySelectorAll(<span class="string">".lazy"</span>);</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">lazyload</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(lazyloadThrottleTimeout) &#123;</span></span><br><span class="line"><span class="undefined">        clearTimeout(lazyloadThrottleTimeout);</span></span><br><span class="line"><span class="undefined">      &#125;    </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      lazyloadThrottleTimeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> scrollTop = <span class="built_in">window</span>.pageYOffset;</span></span><br><span class="line"><span class="javascript">        lazyloadImages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">img</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(img.offsetTop &lt; (<span class="built_in">window</span>.innerHeight + scrollTop)) &#123;</span></span><br><span class="line"><span class="undefined">              img.src = img.dataset.src;</span></span><br><span class="line"><span class="javascript">              img.classList.remove(<span class="string">'lazy'</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(lazyloadImages.length == <span class="number">0</span>) &#123; </span></span><br><span class="line"><span class="javascript">          <span class="built_in">document</span>.removeEventListener(<span class="string">"scroll"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.removeEventListener(<span class="string">"resize"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.removeEventListener(<span class="string">"orientationChange"</span>, lazyload);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;, 20);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(<span class="string">"scroll"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">"orientationChange"</span>, lazyload);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="使用延迟加载创建更好的用户体验"><a href="#使用延迟加载创建更好的用户体验" class="headerlink" title="使用延迟加载创建更好的用户体验"></a>使用延迟加载创建更好的用户体验</h1><h2 id="使用正确的占位符"><a href="#使用正确的占位符" class="headerlink" title="使用正确的占位符"></a>使用正确的占位符</h2><h2 id="为要加载的图像添加缓冲时间"><a href="#为要加载的图像添加缓冲时间" class="headerlink" title="为要加载的图像添加缓冲时间"></a>为要加载的图像添加缓冲时间</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">img &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#F1F1FA</span>;</span></span><br><span class="line"><span class="undefined">  width: 400px;</span></span><br><span class="line"><span class="undefined">  height: 300px;</span></span><br><span class="line"><span class="undefined">  display: block;</span></span><br><span class="line"><span class="undefined">  margin: 10px auto;</span></span><br><span class="line"><span class="undefined">  border: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#container</span> &#123;</span></span><br><span class="line"><span class="undefined">  height: 420px;</span></span><br><span class="line"><span class="undefined">  overflow-y: scroll;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image1.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image2.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image3.jpg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image4.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image5.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image6.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image7.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image8.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image9.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"lazy"</span> <span class="attr">data-src</span>=<span class="string">"https://ik.imagekit.io/demo/img/image10.jpeg?tr=w-400,h-300"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> lazyloadImages;    </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">if</span> (<span class="string">"IntersectionObserver"</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span></span><br><span class="line"><span class="javascript">    lazyloadImages = <span class="built_in">document</span>.querySelectorAll(<span class="string">".lazy"</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> imageObserver = <span class="keyword">new</span> IntersectionObserver(<span class="function"><span class="keyword">function</span>(<span class="params">entries, observer</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(observer);</span></span><br><span class="line"><span class="javascript">      entries.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">entry</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (entry.isIntersecting) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> image = entry.target;</span></span><br><span class="line"><span class="undefined">          image.src = image.dataset.src;</span></span><br><span class="line"><span class="javascript">          image.classList.remove(<span class="string">"lazy"</span>);</span></span><br><span class="line"><span class="undefined">          imageObserver.unobserve(image);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;, &#123;</span></span><br><span class="line"><span class="javascript">      root: <span class="built_in">document</span>.querySelector(<span class="string">"#container"</span>),</span></span><br><span class="line"><span class="javascript">      rootMargin: <span class="string">"0px 0px 500px 0px"</span></span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    lazyloadImages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">image</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">      imageObserver.observe(image);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="javascript">  &#125; <span class="keyword">else</span> &#123;  </span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> lazyloadThrottleTimeout;</span></span><br><span class="line"><span class="javascript">    lazyloadImages = $(<span class="string">".lazy"</span>);</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">lazyload</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(lazyloadThrottleTimeout) &#123;</span></span><br><span class="line"><span class="undefined">        clearTimeout(lazyloadThrottleTimeout);</span></span><br><span class="line"><span class="undefined">      &#125;    </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      lazyloadThrottleTimeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> scrollTop = $(<span class="built_in">window</span>).scrollTop();</span></span><br><span class="line"><span class="javascript">          lazyloadImages.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">var</span> el = $(<span class="keyword">this</span>);</span></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span>(el.offset().top &lt; <span class="built_in">window</span>.innerHeight + scrollTop + <span class="number">500</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> url = el.attr(<span class="string">"data-src"</span>);</span></span><br><span class="line"><span class="javascript">                el.attr(<span class="string">"src"</span>, url);</span></span><br><span class="line"><span class="javascript">                el.removeClass(<span class="string">"lazy"</span>);</span></span><br><span class="line"><span class="javascript">                lazyloadImages = $(<span class="string">".lazy"</span>);</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="undefined">          &#125;);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span>(lazyloadImages.length == <span class="number">0</span>) &#123; </span></span><br><span class="line"><span class="javascript">            $(<span class="built_in">document</span>).off(<span class="string">"scroll"</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="built_in">window</span>).off(<span class="string">"resize"</span>);</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">      &#125;, 20);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    $(<span class="built_in">document</span>).on(<span class="string">"scroll"</span>, lazyload);</span></span><br><span class="line"><span class="javascript">    $(<span class="built_in">window</span>).on(<span class="string">"resize"</span>, lazyload);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="避免延迟加载每张图片"><a href="#避免延迟加载每张图片" class="headerlink" title="避免延迟加载每张图片"></a>避免延迟加载每张图片</h2>
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://www.kaige1220.top/2018/11/16/图片懒加载指南/" data-id="cjojp2woy0009agqgnzi12u4q" class="article-share-link">Share</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/图片懒加载指南/">图片懒加载指南</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2018/11/16/webpack进阶知识/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">webpack进阶知识</div>
    </a>
  
</nav>

  
</article>

<!-- 如果想加入评论，请开启下面代码 -->



    <section id="comments" class="comments">
      <style>
        .comments{margin:30px;padding:10px;background:#fff}
        @media screen and (max-width:800px){.comments{margin:auto;padding:10px;background:#fff}}
      </style>
      

<!-- 如果想加入评论，请开启下面代码 -->



<div id="vcomment" class="comment"></div>
<script src="//cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/leancloud-storage@latest/dist/av-min.js"></script>
<script src='//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js'></script>
<script>
   var notify = 'false' == true ? true : false;
   var verify = 'false' == true ? true : false;
   new Valine({
            av: AV,
            el: '#vcomment',
            notify: notify,
            verify: verify,
            app_id: "OuQqt8QVX498BV3tD1s02tc3-gzGzoHsz",
            app_key: "e6WCHDspJFcu4MaLtqmp9gfF",
            placeholder: "请发表您的观点",
            avatar: "mm",
            avatar_cdn: "",
            pageSize: 15
    });
</script>
    </section>
  


  




</section>
        
      </div>
      <footer id="footer">
  
        <div class="outer">
          <div id="footer-info" class="inner">
            &copy;
            2018
              KAIGE |
                <span id="busuanzi_container_site_pv">
                  您是本站第
                  <span id="busuanzi_value_site_pv"></span>个访客
                </span>
                <br> 
                Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, 
                modify by <a href="https://github.com/txz1220" target="_blank">kaige</a> | 
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> |
                <span>Hosted by
                  <a href="https://pages.coding.me" target="_blank">Coding Pages</a>
                </span>

          </div>

        </div>

</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
</nav>
    -->
    

            <!-- 百度分享 start -->
            <!--  -->
                    <!-- 百度分享 end -->

                    
                <!-- 百度自动推送  开始 -->
                    <script>
                        (function(){
                            var bp = document.createElement('script');
                            var curProtocol = window.location.protocol.split(':')[0];
                            if (curProtocol === 'https') {
                                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                            }
                            else {
                                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                            }
                            var s = document.getElementsByTagName("script")[0];
                            s.parentNode.insertBefore(bp, s);
                        })();
                        </script>
                <!-- 百度自动推送  结束 -->

                    <script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

                    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

                    

                                    <script src="/js/jquery.scrollUp.min.js"></script>
                                        <script src="/js/jquery.transform.js"></script>
                                            <script src="/js/menu.js"></script>

                                                <script src="/js/script.js"></script>
                                                    <script src="/js/scrollUp.js"></script>
  </div>
</body>
</html>